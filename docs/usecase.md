# ç”¨ä¾‹åˆ†æž

é¡¹ç›®åˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸¤éƒ¨åˆ†ã€‚

## å‚ä¸Žè€…

- è®¿å®¢ / æœªç™»å½•ç”¨æˆ·
- å·²ç™»å½•ç”¨æˆ·
- ç®¡ç†å‘˜
- ç³»ç»Ÿï¼ˆåŽç«¯æœåŠ¡ã€Tauri å®¢æˆ·ç«¯ï¼‰

## ä¸»è¦ç”¨ä¾‹

1. æµè§ˆå•†å“åˆ—è¡¨
   - ä¸»å‚ä¸Žè€…ï¼šè®¿å®¢/å·²ç™»å½•ç”¨æˆ·
   - å‰ç½®æ¡ä»¶ï¼šæ— 
   - ä¸»æµç¨‹ï¼šè®¿é—®ä¸»é¡µ â†’ æœç´¢/æŸ¥çœ‹å•†å“åˆ—è¡¨

2. æŸ¥çœ‹å•†å“è¯¦æƒ…
   - ä¸»å‚ä¸Žè€…ï¼šè®¿å®¢/å·²ç™»å½•ç”¨æˆ·
   - å‰ç½®æ¡ä»¶ï¼šå­˜åœ¨æœ‰æ•ˆå•†å“ ID
   - ä¸»æµç¨‹ï¼šç‚¹å‡»å•†å“ â†’ æ‰“å¼€è¯¦æƒ…é¡µ â†’ è¯·æ±‚å•†å“è¯¦æƒ…

3. æ·»åŠ å•†å“
   - ä¸»å‚ä¸Žè€…ï¼šå·²ç™»å½•ç”¨æˆ·
   - å‰ç½®æ¡ä»¶ï¼šç”¨æˆ·å·²ç™»å½•ï¼ˆæœ‰æƒé™ï¼‰
   - ä¸»æµç¨‹ï¼šç‚¹å‡»åŠ å· â†’ å¡«è¡¨æäº¤ â†’ å®¢æˆ·ç«¯è°ƒç”¨åˆ›å»ºæŽ¥å£ â†’ åŽç«¯æŒä¹…åŒ–å•†å“

4. åˆ é™¤å•†å“
   - ä¸»å‚ä¸Žè€…ï¼šå–å®¶ï¼ˆå•†å“æ‰€å±žç”¨æˆ·ï¼‰æˆ–ç®¡ç†å‘˜
   - å‰ç½®æ¡ä»¶ï¼šæœ‰åˆ é™¤æƒé™ï¼ˆæ˜¯å–å®¶æˆ–ç®¡ç†å‘˜ï¼‰
   - ä¸»æµç¨‹ï¼šåœ¨è¯¦æƒ…é¡µå‘èµ·åˆ é™¤ â†’ å®¢æˆ·ç«¯è°ƒç”¨åˆ é™¤æŽ¥å£ â†’ åŽç«¯åˆ é™¤è®°å½•

5. ç™»å½• / ç™»å‡º
   - ä¸»å‚ä¸Žè€…ï¼šè®¿å®¢ï¼ˆæ³¨å†Œ/ç™»å½•ï¼‰
   - å‰ç½®æ¡ä»¶ï¼šæ— ï¼ˆç™»å½•ï¼‰ï¼Œå·²ç™»å½•ï¼ˆç™»å‡ºï¼‰
   - ä¸»æµç¨‹ï¼šå¡«å†™å‡­è¯ â†’ è°ƒç”¨è®¤è¯æŽ¥å£ â†’ æ›´æ–°æœ¬åœ°ä¼šè¯/Token â†’ èŽ·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

6. æ³¨å†Œ
   - ä¸»å‚ä¸Žè€…ï¼šè®¿å®¢
   - å‰ç½®æ¡ä»¶ï¼šæ— 
   - ä¸»æµç¨‹ï¼šå¡«å†™æ³¨å†Œä¿¡æ¯ â†’ è°ƒç”¨æ³¨å†ŒæŽ¥å£ â†’ åˆ›å»ºç”¨æˆ· â†’ è‡ªåŠ¨ç™»å½•

7. æŸ¥çœ‹/ç¼–è¾‘ä¸ªäººèµ„æ–™
   - ä¸»å‚ä¸Žè€…ï¼šå·²ç™»å½•ç”¨æˆ·
   - å‰ç½®æ¡ä»¶ï¼šå·²ç™»å½•å¹¶èŽ·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
   - ä¸»æµç¨‹ï¼šè¿›å…¥ä¸ªäººé¡µé¢ â†’ æŸ¥çœ‹ä¿¡æ¯æˆ–åˆ‡æ¢åˆ°ç¼–è¾‘ â†’ æäº¤æ›´æ–° â†’ åŽç«¯æ›´æ–°å¹¶è¿”å›žæœ€æ–°ç”¨æˆ·

8. ç®¡ç†å‘˜é¢æ¿ï¼ˆç”¨æˆ·ä¸Žå•†å“ç®¡ç†ï¼‰
   - ä¸»å‚ä¸Žè€…ï¼šç®¡ç†å‘˜
   - å‰ç½®æ¡ä»¶ï¼šç”¨æˆ·æ˜¯ç®¡ç†å‘˜ï¼ˆuser.is_admin === trueï¼‰
   - ä¸»æµç¨‹ï¼šæ‰“å¼€ç®¡ç†é¡µ â†’ åˆ‡æ¢æ ‡ç­¾ï¼ˆç”¨æˆ·/å•†å“ï¼‰ â†’ æ‰§è¡Œç®¡ç†æ“ä½œï¼ˆåˆ·æ–°ã€åˆ é™¤ç­‰ï¼‰

9. åŽç«¯ API è°ƒç”¨ / Token ç®¡ç†ï¼ˆç³»ç»Ÿç”¨ä¾‹ï¼‰
   - ä¸»å‚ä¸Žè€…ï¼šç³»ç»Ÿï¼ˆTauri å®¢æˆ·ç«¯ + æœåŠ¡å™¨ï¼‰
   - å‰ç½®æ¡ä»¶ï¼šTauri å®¢æˆ·ç«¯è¿è¡Œï¼Œtoken æ•°æ®æ–‡ä»¶å¤¹å·²åˆå§‹åŒ–
   - ä¸»æµç¨‹ï¼šå®¢æˆ·ç«¯å‘èµ· HTTP è¯·æ±‚ â†’ å¤„ç† token åˆ·æ–°/å­˜å‚¨ â†’ è¿”å›ž ApiResponse ç»™å‰ç«¯

## ç”¨ä¾‹å›¾

```mermaid
graph LR
    %% ä½¿ç”¨ graph è¯­æ³•æ¨¡æ‹Ÿç”¨ä¾‹å›¾ï¼Œå…¼å®¹æ‰€æœ‰ç‰ˆæœ¬

    %% å®šä¹‰è§’è‰² (ä½¿ç”¨æ–¹æ‹¬å·+Emojiæ¨¡æ‹ŸActor)
    Guest["ðŸ‘¤ è®¿å®¢"]
    User["ðŸ‘¤ å·²ç™»å½•ç”¨æˆ·"]
    Admin["ðŸ‘¤ ç®¡ç†å‘˜"]
    System["ðŸ’» ç³»ç»Ÿ"]

    %% å®šä¹‰ç”¨ä¾‹ (ä½¿ç”¨åœ†æ‹¬å·æ¨¡æ‹Ÿæ¤­åœ†)
    UC_Browse("æµè§ˆå•†å“åˆ—è¡¨")
    UC_ViewDetail("æŸ¥çœ‹å•†å“è¯¦æƒ…")
    UC_AddProduct("æ·»åŠ å•†å“")
    UC_DeleteProduct("åˆ é™¤å•†å“")
    UC_Register("æ³¨å†Œ")
    UC_Auth("ç™»å½• / ç™»å‡º")
    UC_ViewEditProfile("æŸ¥çœ‹/ç¼–è¾‘ä¸ªäººèµ„æ–™")
    UC_AdminManageUsers("ç®¡ç†å‘˜ï¼šç®¡ç†ç”¨æˆ·")
    UC_AdminManageProducts("ç®¡ç†å‘˜ï¼šç®¡ç†å•†å“")
    UC_API("åŽç«¯ API / Token ç®¡ç†")

    %% è®¿å®¢å…³ç³»
    Guest --> UC_Register

    %% ç”¨æˆ·å…³ç³»
    User --> UC_Browse
    User --> UC_ViewDetail
    User --> UC_AddProduct
    User --> UC_DeleteProduct
    User --> UC_ViewEditProfile
    User --> UC_Auth

    %% ç®¡ç†å‘˜å…³ç³»
    Admin --> UC_Browse
    Admin --> UC_ViewDetail
    Admin --> UC_AddProduct
    Admin --> UC_DeleteProduct
    Admin --> UC_ViewEditProfile
    Admin --> UC_AdminManageUsers
    Admin --> UC_AdminManageProducts
    Admin --> UC_Auth

    %% ç³»ç»Ÿä¸ŽAPIä¾èµ–å…³ç³» (ä½¿ç”¨è™šçº¿ -.->)
    System -.->|supports| UC_API
    UC_Auth -.->|uses| UC_API
    UC_Register -.->|uses| UC_API
    UC_Browse -.->|uses| UC_API
    UC_ViewDetail -.->|uses| UC_API
    UC_AddProduct -.->|uses| UC_API
    UC_DeleteProduct -.->|uses| UC_API
    UC_ViewEditProfile -.->|uses| UC_API
    UC_AdminManageUsers -.->|uses| UC_API
    UC_AdminManageProducts -.->|uses| UC_API
```

## é¡ºåºå›¾

### ç™»å½• / ç™»å‡º

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant FE as å‰ç«¯/Tauri
    participant API as åŽç«¯API
    participant DB as æ•°æ®åº“

    U->>FE: æäº¤ç”¨æˆ·å/å¯†ç 
    FE->>API: POST /api/login
    API->>DB: æ ¡éªŒç”¨æˆ·ã€å¯†ç å“ˆå¸Œ
    DB-->>API: è®¤è¯ç»“æžœ
    API-->>FE: è¿”å›ž Token
    FE-->>U: æŒä¹…åŒ– Token

    FE->>API: POST /api/user/me
    API->>DB: æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
    DB-->>API: ç”¨æˆ·è®°å½•
    API-->>FE: è¿”å›ž User
    FE-->>U: è¿›å…¥åº”ç”¨

    U->>FE: ç‚¹å‡»ç™»å‡º
    FE->>API: POST /api/logout
    FE-->>U: æ¸…ç†æœ¬åœ° Tokenï¼Œé€€å‡º
```

### æ³¨å†Œ

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant FE as å‰ç«¯/Tauri
    participant API as åŽç«¯API
    participant DB as æ•°æ®åº“

    U->>FE: æäº¤ç”¨æˆ·å/é‚®ç®±/å¯†ç 
    FE->>API: POST /register
    API->>DB: å†™å…¥ç”¨æˆ· + å“ˆå¸Œå¯†ç 
    DB-->>API: å†™å…¥æˆåŠŸ
    API-->>FE: è¿”å›žç™»å½•æˆåŠŸä¿¡æ¯
    FE-->>U: æ³¨å†ŒæˆåŠŸ
```

### ç®¡ç†å‘˜æŸ¥çœ‹

```mermaid
sequenceDiagram
    participant A as ç®¡ç†å‘˜
    participant FE as å‰ç«¯/Tauri
    participant API as åŽç«¯API
    participant DB as æ•°æ®åº“

    A->>FE: æ‰“å¼€ç®¡ç†-ç”¨æˆ·é¡µ
    FE->>API: GET /api/admin/users
    API->>DB: æŸ¥è¯¢å…¨éƒ¨ç”¨æˆ·
    DB-->>API: ç”¨æˆ·åˆ—è¡¨
    API-->>FE: è¿”å›žç”¨æˆ·åˆ—è¡¨
    FE-->>A: å±•ç¤ºç”¨æˆ·è¡¨æ ¼

    A->>FE: æ‰“å¼€ç®¡ç†-å•†å“é¡µ/å•†å“è¯¦æƒ…
    FE->>API: GET /api/products
    API->>DB: æŸ¥è¯¢å•†å“åˆ—è¡¨
    DB-->>API: å•†å“åˆ—è¡¨
    API-->>FE: è¿”å›žå•†å“åˆ—è¡¨
    FE-->>A: å±•ç¤ºåˆ—è¡¨
```

### åˆ é™¤å•†å“

> ç®¡ç†å‘˜ä¸Žå•†å“æ‰€æœ‰è€…å…±ç”¨åŒä¸€å•†å“æŽ¥å£ï¼ˆ/api/product/:idï¼‰ï¼ŒåŽç«¯ä¼šåœ¨æŽ§åˆ¶å™¨å†…æ”¾è¡Œç®¡ç†å‘˜ã€‚

```mermaid
sequenceDiagram
    participant A as ç”¨æˆ·/ç®¡ç†å‘˜
    participant FE as å‰ç«¯/Tauri
    participant API as åŽç«¯API
    participant DB as æ•°æ®åº“

    A->>FE: æ‰“å¼€ç®¡ç†-å•†å“é¡µ/å•†å“è¯¦æƒ…
    FE->>API: GET /api/products
    API->>DB: æŸ¥è¯¢å•†å“åˆ—è¡¨
    DB-->>API: å•†å“åˆ—è¡¨
    API-->>FE: è¿”å›žå•†å“åˆ—è¡¨
    FE-->>A: å±•ç¤ºåˆ—è¡¨

    A->>FE: ç‚¹å‡»åˆ é™¤å•†å“{id}
    FE->>API: DELETE /api/product/{id}
    API->>DB: åˆ é™¤å•†å“è®°å½•
    DB-->>API: åˆ é™¤ç»“æžœ
    API-->>FE: è¿”å›žåˆ é™¤æˆåŠŸ
    FE-->>A: åˆ—è¡¨åˆ·æ–°/æç¤ºæˆåŠŸ
```

### æµè§ˆ/æŸ¥çœ‹å•†å“è¯¦æƒ…

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant FE as å‰ç«¯/Tauri
    participant API as åŽç«¯API
    participant DB as æ•°æ®åº“

    U->>FE: æ‰“å¼€é¦–é¡µ/æœç´¢
    FE->>API: GET /products?keyword=...
    API->>DB: æŸ¥è¯¢å•†å“åˆ—è¡¨
    DB-->>API: åˆ—è¡¨ç»“æžœ
    API-->>FE: è¿”å›žå•†å“åˆ—è¡¨
    FE-->>U: å±•ç¤ºåˆ—è¡¨

    U->>FE: ç‚¹å‡»æŸå•†å“
    FE->>API: GET /product/{id}
    API->>DB: æŸ¥è¯¢å•†å“ + å–å®¶ä¿¡æ¯
    DB-->>API: å•†å“ä¸Žå–å®¶
    API-->>FE: è¿”å›žè¯¦æƒ…
    FE-->>U: å±•ç¤ºè¯¦æƒ…
```

### æ·»åŠ å•†å“ï¼ˆå·²ç™»å½•ç”¨æˆ·ï¼‰

```mermaid
sequenceDiagram
    participant U as å·²ç™»å½•ç”¨æˆ·
    participant FE as å‰ç«¯/Tauri
    participant API as åŽç«¯API
    participant DB as æ•°æ®åº“

    U->>FE: æ‰“å¼€æ·»åŠ å•†å“è¡¨å•
    FE-->>U: é¢„å¡«/æ ¡éªŒè¡¨å•
    U->>FE: æäº¤åç§°/æè¿°/ä»·æ ¼
    FE->>API: POST /product
    API->>DB: æ’å…¥å•†å“ï¼Œå…³è” UserID
    DB-->>API: æ–°å•†å“è®°å½•
    API-->>FE: è¿”å›žåˆ›å»ºåŽçš„å•†å“
    FE-->>U: åˆ—è¡¨åˆ·æ–°/è·³è½¬è¯¦æƒ…
```

## ç±»å›¾

<!-- TODO -->

```mermaid
classDiagram
    %% Backend Models
    class User {
        -uint ID
        -string Username
        -string Email
        -string Phone
        -string Address
        -bool IsAdmin
        +Product[] Products
    }

    class UserAuth {
        -uint ID
        -string Password
    }

    class Product {
        -uint ID
        -string Name
        -string Description
        -int Price
        -time CreatedAt
        -uint UserID
        +User User
    }

    %% Backend DTOs
    class RegisterRequest {
        -string Username
        -string Email
        -string Password
    }

    class UpdateUserRequest {
        -string Username
        -string Email
        -string Phone
        -string Address
    }

    class UpdatePasswordRequest {
        -string OldPassword
        -string NewPassword
    }

    class UserDTO {
        -uint ID
        -string Username
        -string Email
        -string Phone
        -string Address
        -bool IsAdmin
    }

    class CreateProductRequest {
        -string Name
        -string Description
        -int Price
    }

    class UpdateProductRequest {
        -string Name
        -string Description
        -int Price
    }

    class ProductResponse {
        -uint ID
        -string Name
        -string Description
        -int Price
        -Seller Seller
    }

    class Seller {
        -uint ID
        -string Username
        -string Email
        -string Phone
        -string Address
    }

    %% Service Interfaces and Implementations
    class ProductService {
        <<interface>>
        +CreateProduct(userID uint, name, description string, price int)*
        +GetProduct(productID uint)*
        +UpdateProduct(productID uint, name, description string, price int)*
        +DeleteProduct(productID uint)*
        +SearchProducts(keyword string)*
    }

    class ProductServiceImpl {
        -DB* DB
        +CreateProduct(userID uint, name, description string, price int) Product
        +GetProduct(productID uint) Product
        +UpdateProduct(productID uint, name, description string, price int) Product
        +DeleteProduct(productID uint) error
        +SearchProducts(keyword string) Product[]
    }

    class UserService {
        <<interface>>
        +GetUser(userID uint)*
        +GetAllUsers()*
        +UpdateUser(userID uint, username, email, phone, address string)*
        +UpdateUserPassword(userID uint, oldPassword, newPassword string)*
        +DeleteUser(userID uint)*
    }

    class UserServiceImpl {
        -DB* DB
        +GetUser(userID uint) User
        +GetAllUsers() User[]
        +UpdateUser(userID uint, username, email, phone, address string) User
        +UpdateUserPassword(userID uint, oldPassword, newPassword string) error
        +DeleteUser(userID uint) error
    }

    class AuthService {
        <<interface>>
        +LoginAuthenticator(c gin.Context)*
        +RegisterUser(username, email, password string)*
    }

    class AuthServiceImpl {
        -DB* DB
        -UserService UserService
        +LoginAuthenticator(c gin.Context) any
        +RegisterUser(username, email, password string) error
    }

    %% Frontend Types
    class ApiResponse {
        <<interface>>
        -int code
        -string message
        -bool success
        -T data
    }

    class FrontendUser {
        -int id
        -string username
        -string email
        -string phone
        -string address
        -bool is_admin
    }

    class FrontendProduct {
        -int id
        -string name
        -string description
        -int price
        -Seller? seller
    }

    class LoginPayload {
        -string username
        -string password
    }

    class RegisterPayload {
        -string username
        -string email
        -string password
    }

    class ProductFormData {
        -string name
        -string description
        -int price
    }

    %% Relationships
    User "1" -- "1" UserAuth : has
    User "1" -- "*" Product : creates
    Product "*" -- "1" User : belongsTo

    ProductServiceImpl --|> ProductService : implements
    UserServiceImpl --|> UserService : implements
    AuthServiceImpl --|> AuthService : implements

    UserDTO --|> User : mapsFrom
    ProductResponse --|> Product : mapsFrom
    Seller --|> User : extractedFrom

    RegisterRequest --|> User : convertsTo
    UpdateUserRequest --|> User : updates
    CreateProductRequest --|> Product : convertsTo
    UpdateProductRequest --|> Product : updates

    AuthServiceImpl --> UserService : uses
    ProductServiceImpl --> Product : persists
    UserServiceImpl --> User : persists

    ApiResponse --> FrontendUser : contains
    ApiResponse --> FrontendProduct : contains
    FrontendProduct "1" -- "1" Seller : hasA

    LoginPayload --> AuthService : usedBy
    ProductFormData --> CreateProductRequest : convertsTo
```
